.d3-tree-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: linear-gradient(135deg, #FAF7F1 0%, #FFF9F5 100%); // Nubian warm white gradient
  position: relative;
}

.d3-tree-svg {
  width: 100%;
  height: 100%;
  cursor: grab;

  &:active {
    cursor: grabbing;
  }
}

// TODO: ::ng-deep is deprecated. Consider using component styles with ViewEncapsulation.None
// or restructuring styles to avoid deep selectors.
// See: https://angular.io/guide/component-styles#deprecated-deep--and-ng-deep
:host ::ng-deep {
  .person-node {
    cursor: grab;
    transition: filter 0.2s ease;

    &:hover {
      filter: url(#hoverShadow);
    }

    &.selected .node-rect {
      stroke-width: 4px;
      stroke: #187573; // Nubian teal
    }

    &.dragging {
      cursor: grabbing;
      filter: url(#hoverShadow);
      opacity: 0.9;

      .node-rect {
        stroke-width: 3px;
        stroke: #E85D35; // Nubian orange
      }
    }
  }

  .node-rect {
    filter: url(#dropShadow);
    transition: all 0.2s ease;
  }

  .node-rect-male {
    fill: url(#maleGradient);
    stroke: #187573; // Nubian teal
    stroke-width: 2px;
  }

  .node-rect-female {
    fill: url(#femaleGradient);
    stroke: #C17E3E; // Nubian gold
    stroke-width: 2px;
  }

  .node-rect-unknown {
    fill: url(#unknownGradient);
    stroke: #6B6B6B; // Nubian gray
    stroke-width: 2px;
  }

  .node-name {
    font-family: 'Inter', 'Roboto', sans-serif;
    font-size: 12px;
    font-weight: 600;
    fill: #2D2D2D; // Nubian charcoal
    text-anchor: start;
    pointer-events: none;
  }

  .node-dates {
    font-family: 'Inter', 'Roboto', sans-serif;
    font-size: 10px;
    fill: #6B6B6B; // Nubian gray
    text-anchor: start;
    pointer-events: none;
  }

  .node-avatar {
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    font-weight: 700;
    text-anchor: middle;
    dominant-baseline: central;
    pointer-events: none;
  }

  .link-parent-child {
    fill: none;
    stroke: #CEC5B0; // Nubian sand
    stroke-width: 2px;
  }

  .link-spouse {
    fill: none;
    stroke: #E85D35; // Nubian orange
    stroke-width: 2px;
    stroke-dasharray: 5, 5;
  }

  .living-indicator {
    fill: #2D7A3E; // Nubian green
  }

  .generation-label {
    font-family: 'Inter', 'Roboto', sans-serif;
    font-size: 13px;
    font-weight: 600;
    fill: #2D2D2D; // Nubian charcoal
    text-anchor: middle;
    pointer-events: none;
  }

  .generation-count {
    font-family: 'Inter', 'Roboto', sans-serif;
    font-size: 11px;
    fill: #6B6B6B; // Nubian gray
    pointer-events: none;
  }

  .collapse-indicator {
    pointer-events: none;
    transition: transform 0.2s ease;
  }

  .generation-label-group {
    transition: transform 0.2s ease;

    &.clickable {
      cursor: pointer;

      &:hover {
        transform: scale(1.02);
      }
    }
  }

  .generation-label-bg {
    transition: all 0.2s ease;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));

    &.collapsed {
      opacity: 0.8;
    }
  }

  .generation-bands {
    pointer-events: none;
  }

  .generation-band {
    pointer-events: none;
    transition: fill 0.3s ease;
  }

  .cross-tree-badge {
    cursor: pointer;
    transition: transform 0.2s ease;

    &:hover {
      transform: scale(1.2);
    }
  }

  .badge-circle {
    stroke: white;
    stroke-width: 2px;
  }

  .badge-circle-same {
    fill: #2D7A3E; // Nubian green
  }

  .badge-circle-ancestor {
    fill: #187573; // Nubian teal
  }

  .badge-circle-related {
    fill: #C17E3E; // Nubian gold
  }

  .badge-count {
    font-family: 'Roboto', sans-serif;
    font-size: 10px;
    font-weight: 700;
    fill: white;
    text-anchor: middle;
    dominant-baseline: central;
    pointer-events: none;
  }
}

.cross-tree-tooltip {
  position: absolute;
  z-index: 1000;
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  padding: 12px;
  max-width: 280px;
  pointer-events: auto;

  .tooltip-content {
    font-family: 'Roboto', sans-serif;
    font-size: 13px;
    color: #333;

    .tooltip-header {
      font-weight: 600;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }

    .tooltip-link-item {
      display: flex;
      align-items: center;
      padding: 6px 0;
      cursor: pointer;
      border-radius: 4px;

      &:hover {
        background: #f5f5f5;
      }

      .link-type-badge {
        font-size: 10px;
        font-weight: 600;
        padding: 2px 6px;
        border-radius: 4px;
        margin-right: 8px;
        color: white;

        &.same { background: #4caf50; }
        &.ancestor { background: #2196f3; }
        &.related { background: #ff9800; }
      }

      .link-info {
        flex: 1;

        .link-person {
          font-weight: 500;
        }

        .link-tree {
          font-size: 11px;
          color: #666;
        }

        .link-town {
          font-size: 10px;
          color: #999;
        }
      }

      .jump-icon {
        color: #1976d2;
        font-size: 16px;
      }
    }
  }
}
