<div class="admin-panel">
  <div class="admin-panel__header">
    <h1 class="admin-panel__title">
      <i class="fa-solid fa-user-shield" aria-hidden="true"></i>
      {{ 'admin.title' | translate }}
    </h1>
    <p class="admin-panel__subtitle">{{ 'admin.subtitle' | translate }}</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card stat-card--users">
      <mat-card-content>
        <div class="stat-card__icon">
          <i class="fa-solid fa-users" aria-hidden="true"></i>
        </div>
        <div class="stat-card__content">
          <span class="stat-card__value">{{ stats()?.totalUsers || 0 }}</span>
          <span class="stat-card__label">{{ 'admin.totalUsers' | translate }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card stat-card--trees">
      <mat-card-content>
        <div class="stat-card__icon">
          <i class="fa-solid fa-sitemap" aria-hidden="true"></i>
        </div>
        <div class="stat-card__content">
          <span class="stat-card__value">{{ stats()?.totalTrees || 0 }}</span>
          <span class="stat-card__label">{{ 'trees.title' | translate }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card stat-card--people">
      <mat-card-content>
        <div class="stat-card__icon">
          <i class="fa-solid fa-user" aria-hidden="true"></i>
        </div>
        <div class="stat-card__content">
          <span class="stat-card__value">{{ stats()?.totalPeople || 0 }}</span>
          <span class="stat-card__label">{{ 'admin.totalPeople' | translate }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card stat-card--relations">
      <mat-card-content>
        <div class="stat-card__icon">
          <i class="fa-solid fa-people-roof" aria-hidden="true"></i>
        </div>
        <div class="stat-card__content">
          <span class="stat-card__value">{{ stats()?.totalRelationships || 0 }}</span>
          <span class="stat-card__label">{{ 'admin.totalRelationships' | translate }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Quick Links -->
  <div class="quick-links">
    <a routerLink="/pending-links" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-link" aria-hidden="true"></i>
          <span>{{ 'nav.pendingLinks' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/countries" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-globe" aria-hidden="true"></i>
          <span>{{ 'admin.countries.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/carousel-images" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-images" aria-hidden="true"></i>
          <span>{{ 'admin.carouselImages.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/town-images" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-photo-film" aria-hidden="true"></i>
          <span>{{ 'admin.townImages.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/storage-migration" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-cloud-arrow-up" aria-hidden="true"></i>
          <span>{{ 'admin.storageMigration.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/duplicates" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-people-arrows" aria-hidden="true"></i>
          <span>{{ 'admin.duplicateDetection.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/predictions" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true"></i>
          <span>{{ 'admin.predictions.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/suggestions" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-lightbulb" aria-hidden="true"></i>
          <span>{{ 'admin.suggestions.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/media-approval" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-clipboard-check" aria-hidden="true"></i>
          <span>{{ 'media.approvalQueue' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/support-tickets" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-headset" aria-hidden="true"></i>
          <span>{{ 'support.admin.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
    <a routerLink="/admin/activity-logs" class="quick-link">
      <mat-card>
        <mat-card-content>
          <i class="fa-solid fa-clock-rotate-left" aria-hidden="true"></i>
          <span>{{ 'admin.activityLogs.title' | translate }}</span>
          <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
        </mat-card-content>
      </mat-card>
    </a>
  </div>

  <!-- Tabs -->
  <mat-card class="admin-panel__content">
    <mat-tab-group animationDuration="200ms">
      <!-- Users Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <i class="fa-solid fa-users" aria-hidden="true"></i>
          <span>{{ 'admin.users' | translate }}</span>
        </ng-template>

        <div class="tab-content">
          <div class="tab-header">
            <h3>{{ 'admin.systemUsers' | translate }}</h3>
            <button mat-flat-button color="primary" (click)="showCreateUserModal = true">
              <i class="fa-solid fa-user-plus" aria-hidden="true"></i>
              {{ 'admin.createUser' | translate }}
            </button>
          </div>
          @if (loading()) {
            <div class="loading-container">
              <mat-spinner diameter="40"></mat-spinner>
            </div>
          } @else {
            <table mat-table [dataSource]="users()" class="users-table">
              <!-- User Column -->
              <ng-container matColumnDef="user">
                <th mat-header-cell *matHeaderCellDef>{{ 'admin.user' | translate }}</th>
                <td mat-cell *matCellDef="let user">
                  <div class="user-cell">
                    <div class="user-avatar">
                      {{ getInitials(user.firstName, user.lastName) }}
                    </div>
                    <div class="user-info">
                      <span class="user-name">{{ user.firstName }} {{ user.lastName }}</span>
                      <span class="user-email">{{ user.email }}</span>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Role Column -->
              <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef>{{ 'admin.systemRole' | translate }}</th>
                <td mat-cell *matCellDef="let user">
                  <mat-form-field appearance="outline" class="role-select">
                    <mat-select
                      [value]="user.systemRole"
                      (selectionChange)="updateUserRole(user, $event.value)">
                      <mat-option value="User">{{ 'roles.user' | translate }}</mat-option>
                      <mat-option value="Admin">{{ 'roles.admin' | translate }}</mat-option>
                      <mat-option value="SuperAdmin">{{ 'roles.superAdmin' | translate }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </td>
              </ng-container>

              <!-- Trees Column -->
              <ng-container matColumnDef="trees">
                <th mat-header-cell *matHeaderCellDef>{{ 'trees.title' | translate }}</th>
                <td mat-cell *matCellDef="let user">
                  <span class="tree-count">{{ user.treeCount || 0 }}</span>
                </td>
              </ng-container>

              <!-- Created Column -->
              <ng-container matColumnDef="created">
                <th mat-header-cell *matHeaderCellDef>{{ 'admin.created' | translate }}</th>
                <td mat-cell *matCellDef="let user">
                  {{ user.createdAt | date:'mediumDate' }}
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>{{ 'common.actions' | translate }}</th>
                <td mat-cell *matCellDef="let user">
                  @if (user.systemRole === 'Admin') {
                    <button mat-stroked-button color="primary" (click)="openAssignTownDialog(user)">
                      <i class="fa-solid fa-city" aria-hidden="true"></i>
                      {{ 'admin.assignTowns' | translate }}
                    </button>
                  }
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="userColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: userColumns;"></tr>
            </table>

            @if (users().length === 0) {
              <div class="empty-state">
                <i class="fa-solid fa-users" aria-hidden="true"></i>
                <p>{{ 'admin.noUsersFound' | translate }}</p>
              </div>
            }
          }
        </div>
      </mat-tab>

      <!-- Town Assignments Tab (Primary - Town-scoped access) -->
      <mat-tab>
        <ng-template mat-tab-label>
          <i class="fa-solid fa-city" aria-hidden="true"></i>
          <span>{{ 'admin.townAssignments' | translate }}</span>
        </ng-template>

        <div class="tab-content">
          <div class="tab-header">
            <h3>{{ 'admin.adminTownAssignments' | translate }}</h3>
            <p class="tab-description">{{ 'admin.townAssignmentsDesc' | translate }}</p>
            <button mat-flat-button color="primary" (click)="openAssignTownDialog()">
              <i class="fa-solid fa-plus" aria-hidden="true"></i>
              {{ 'admin.assignTown' | translate }}
            </button>
          </div>

          <table mat-table [dataSource]="townAssignments()" class="assignments-table">
            <ng-container matColumnDef="admin">
              <th mat-header-cell *matHeaderCellDef>{{ 'roles.admin' | translate }}</th>
              <td mat-cell *matCellDef="let a">
                <div class="user-cell">
                  <div class="user-avatar user-avatar--small">
                    {{ getInitials(a.userName?.split(' ')[0], a.userName?.split(' ')[1]) }}
                  </div>
                  <div class="user-info">
                    <span class="user-name">{{ a.userName }}</span>
                    <span class="user-email">{{ a.userEmail }}</span>
                  </div>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="town">
              <th mat-header-cell *matHeaderCellDef>{{ 'admin.town' | translate }}</th>
              <td mat-cell *matCellDef="let a">
                <mat-chip-set>
                  <mat-chip class="town-chip">
                    <i class="fa-solid fa-city" aria-hidden="true"></i>
                    {{ getLocalizedAssignmentTownName(a) }}
                  </mat-chip>
                </mat-chip-set>
              </td>
            </ng-container>

            <ng-container matColumnDef="trees">
              <th mat-header-cell *matHeaderCellDef>{{ 'trees.title' | translate }}</th>
              <td mat-cell *matCellDef="let a">
                <span class="tree-count">{{ a.treeCount }} {{ 'trees.title' | translate | lowercase }}</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="assignedBy">
              <th mat-header-cell *matHeaderCellDef>{{ 'admin.assignedBy' | translate }}</th>
              <td mat-cell *matCellDef="let a">{{ a.assignedByName || ('admin.system' | translate) }}</td>
            </ng-container>

            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>{{ 'admin.date' | translate }}</th>
              <td mat-cell *matCellDef="let a">{{ a.assignedAt | date:'mediumDate' }}</td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>{{ 'common.actions' | translate }}</th>
              <td mat-cell *matCellDef="let a">
                <button mat-icon-button color="warn" (click)="removeTownAssignment(a)">
                  <i class="fa-solid fa-trash" aria-hidden="true"></i>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="townAssignmentColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: townAssignmentColumns;"></tr>
          </table>

          @if (townAssignments().length === 0) {
            <div class="empty-state">
              <i class="fa-solid fa-city" aria-hidden="true"></i>
              <p>{{ 'admin.noTownAssignments' | translate }}</p>
              <span class="empty-hint">{{ 'admin.noTownAssignmentsHint' | translate }}</span>
            </div>
          }
        </div>
      </mat-tab>


      <!-- All Trees Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <i class="fa-solid fa-tree" aria-hidden="true"></i>
          <span>{{ 'admin.allTrees' | translate }}</span>
        </ng-template>

        <div class="tab-content">
          <table mat-table [dataSource]="allTrees()" class="trees-table">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>{{ 'common.name' | translate }}</th>
              <td mat-cell *matCellDef="let tree">
                <div class="tree-cell">
                  <i class="fa-solid fa-sitemap tree-icon" aria-hidden="true"></i>
                  <div class="tree-info">
                    <span class="tree-name">{{ tree.name }}</span>
                    @if (tree.description) {
                      <span class="tree-desc">{{ tree.description }}</span>
                    }
                  </div>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="people">
              <th mat-header-cell *matHeaderCellDef>{{ 'admin.totalPeople' | translate }}</th>
              <td mat-cell *matCellDef="let tree">{{ tree.personCount }}</td>
            </ng-container>

            <ng-container matColumnDef="public">
              <th mat-header-cell *matHeaderCellDef>{{ 'admin.visibility' | translate }}</th>
              <td mat-cell *matCellDef="let tree">
                @if (tree.isPublic) {
                  <mat-chip class="visibility-chip visibility-chip--public">
                    <i class="fa-solid fa-globe" aria-hidden="true"></i>
                    {{ 'common.public' | translate }}
                  </mat-chip>
                } @else {
                  <mat-chip class="visibility-chip visibility-chip--private">
                    <i class="fa-solid fa-lock" aria-hidden="true"></i>
                    {{ 'admin.private' | translate }}
                  </mat-chip>
                }
              </td>
            </ng-container>

            <ng-container matColumnDef="created">
              <th mat-header-cell *matHeaderCellDef>{{ 'admin.created' | translate }}</th>
              <td mat-cell *matCellDef="let tree">{{ tree.createdAt | date:'mediumDate' }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="treeColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: treeColumns;"></tr>
          </table>

          @if (allTrees().length === 0) {
            <div class="empty-state">
              <i class="fa-solid fa-tree" aria-hidden="true"></i>
              <p>{{ 'admin.noTreesYet' | translate }}</p>
            </div>
          }
        </div>
      </mat-tab>

      <!-- Transliteration Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <i class="fa-solid fa-language" aria-hidden="true"></i>
          <span>{{ 'admin.transliteration' | translate }}</span>
        </ng-template>

        <div class="tab-content transliteration-tab">
          <div class="transliteration-header">
            <h3>{{ 'admin.generateMissingTranslations' | translate }}</h3>
            <p class="transliteration-desc">
              {{ 'admin.transliterationDesc' | translate }}
            </p>
          </div>

          <!-- Bulk Generation Section -->
          <mat-card class="transliteration-card">
            <mat-card-header>
              <mat-card-title>
                <i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true"></i>
                {{ 'admin.bulkGenerate' | translate }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="bulk-options">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'admin.maxPersonsToProcess' | translate }}</mat-label>
                  <input matInput type="number" [(ngModel)]="bulkTranslitOptions.maxPersons" min="1" max="500">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>{{ 'nav.familyTree' | translate }}</mat-label>
                  <mat-select [(ngModel)]="bulkTranslitOptions.orgId">
                    <mat-option value="">{{ 'admin.allTreesMyOrg' | translate }}</mat-option>
                    @for (tree of allTrees(); track tree.id) {
                      <mat-option [value]="tree.id">{{ tree.name }}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>

              @if (bulkTranslitResult()) {
                <div class="translit-result" [class.translit-result--success]="bulkTranslitResult()!.success">
                  <div class="translit-result__header">
                    <i class="fa-solid" [class.fa-check-circle]="bulkTranslitResult()!.success" [class.fa-exclamation-circle]="!bulkTranslitResult()!.success" aria-hidden="true"></i>
                    <span>{{ bulkTranslitResult()!.message }}</span>
                  </div>
                  <div class="translit-result__stats">
                    <span><strong>{{ bulkTranslitResult()!.totalPersonsProcessed }}</strong> {{ 'admin.personsProcessed' | translate }}</span>
                    <span><strong>{{ bulkTranslitResult()!.totalNamesGenerated }}</strong> {{ 'admin.namesGenerated' | translate }}</span>
                    @if (bulkTranslitResult()!.errors > 0) {
                      <span class="error-count"><strong>{{ bulkTranslitResult()!.errors }}</strong> {{ 'admin.errors' | translate }}</span>
                    }
                  </div>
                </div>
              }
            </mat-card-content>
            <mat-card-actions align="end">
              <button mat-flat-button color="primary"
                      [disabled]="bulkTranslitLoading()"
                      (click)="runBulkTransliteration()">
                @if (bulkTranslitLoading()) {
                  <mat-spinner diameter="20"></mat-spinner>
                  {{ 'admin.processing' | translate }}
                } @else {
                  <i class="fa-solid fa-play" aria-hidden="true"></i>
                  {{ 'admin.generateMissingNames' | translate }}
                }
              </button>
            </mat-card-actions>
          </mat-card>

          <!-- Mappings Needing Review -->
          <mat-card class="transliteration-card">
            <mat-card-header>
              <mat-card-title>
                <i class="fa-solid fa-flag" aria-hidden="true"></i>
                {{ 'admin.mappingsNeedingReview' | translate }} ({{ mappingsNeedingReview().length }})
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              @if (mappingsNeedingReview().length > 0) {
                <table mat-table [dataSource]="mappingsNeedingReview()" class="mappings-table">
                  <ng-container matColumnDef="arabic">
                    <th mat-header-cell *matHeaderCellDef>{{ 'admin.arabic' | translate }}</th>
                    <td mat-cell *matCellDef="let m" class="rtl-cell">{{ m.arabic || '—' }}</td>
                  </ng-container>

                  <ng-container matColumnDef="english">
                    <th mat-header-cell *matHeaderCellDef>{{ 'admin.english' | translate }}</th>
                    <td mat-cell *matCellDef="let m">{{ m.english || '—' }}</td>
                  </ng-container>

                  <ng-container matColumnDef="nobiin">
                    <th mat-header-cell *matHeaderCellDef>{{ 'admin.nobiin' | translate }}</th>
                    <td mat-cell *matCellDef="let m" class="nobiin-cell">{{ m.nobiin || '—' }}</td>
                  </ng-container>

                  <ng-container matColumnDef="confidence">
                    <th mat-header-cell *matHeaderCellDef>{{ 'admin.confidence' | translate }}</th>
                    <td mat-cell *matCellDef="let m">
                      <mat-chip [class]="'confidence-' + getConfidenceLevel(m.confidence)">
                        {{ (m.confidence * 100).toFixed(0) }}%
                      </mat-chip>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>{{ 'common.actions' | translate }}</th>
                    <td mat-cell *matCellDef="let m">
                      <button mat-icon-button color="primary" (click)="verifyMapping(m)" [matTooltip]="'admin.verify' | translate">
                        <i class="fa-solid fa-check" aria-hidden="true"></i>
                      </button>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="mappingColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: mappingColumns;"></tr>
                </table>
              } @else {
                <div class="empty-state empty-state--small">
                  <i class="fa-solid fa-circle-check" aria-hidden="true"></i>
                  <p>{{ 'admin.allMappingsVerified' | translate }}</p>
                </div>
              }
            </mat-card-content>
            <mat-card-actions align="end">
              <button mat-button (click)="loadMappingsNeedingReview()">
                <i class="fa-solid fa-refresh" aria-hidden="true"></i>
                {{ 'admin.refresh' | translate }}
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Analytics Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <i class="fa-solid fa-chart-line" aria-hidden="true"></i>
          <span>{{ 'admin.analytics.title' | translate }}</span>
        </ng-template>
        <div class="tab-content">
          <app-analytics-tab></app-analytics-tab>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-card>

  <!-- Create User Modal -->
  @if (showCreateUserModal) {
    <div class="modal-backdrop" (click)="showCreateUserModal = false">
      <mat-card class="modal-card" (click)="$event.stopPropagation()">
        <mat-card-header>
          <mat-card-title>{{ 'admin.createNewUser' | translate }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'common.email' | translate }}</mat-label>
            <input matInput type="email" [(ngModel)]="newUser.email" [placeholder]="'admin.emailPlaceholder' | translate">
            <i matPrefix class="fa-solid fa-envelope input-prefix-icon" aria-hidden="true"></i>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'auth.password' | translate }}</mat-label>
            <input matInput [type]="hidePassword ? 'password' : 'text'" [(ngModel)]="newUser.password">
            <i matPrefix class="fa-solid fa-lock input-prefix-icon" aria-hidden="true"></i>
            <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
              <i class="fa-solid" [class.fa-eye-slash]="hidePassword" [class.fa-eye]="!hidePassword" aria-hidden="true"></i>
            </button>
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>{{ 'common.firstName' | translate }}</mat-label>
              <input matInput [(ngModel)]="newUser.firstName">
              <i matPrefix class="fa-solid fa-user input-prefix-icon" aria-hidden="true"></i>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>{{ 'common.lastName' | translate }}</mat-label>
              <input matInput [(ngModel)]="newUser.lastName">
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'admin.systemRole' | translate }}</mat-label>
            <mat-select [(ngModel)]="newUser.systemRole">
              <mat-option value="User">{{ 'admin.roles.user' | translate }}</mat-option>
              <mat-option value="Admin">{{ 'admin.roles.admin' | translate }}</mat-option>
              <mat-option value="SuperAdmin">{{ 'admin.roles.superAdmin' | translate }}</mat-option>
            </mat-select>
            <i matPrefix class="fa-solid fa-user-shield input-prefix-icon" aria-hidden="true"></i>
          </mat-form-field>

          @if (createUserError) {
            <div class="error-message">
              <i class="fa-solid fa-circle-exclamation" aria-hidden="true"></i>
              {{ createUserError }}
            </div>
          }
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-button (click)="closeCreateUserModal()">{{ 'common.cancel' | translate }}</button>
          <button mat-flat-button color="primary" (click)="createUser()" [disabled]="creatingUser()">
            @if (creatingUser()) {
              <mat-spinner diameter="20"></mat-spinner>
            } @else {
              {{ 'admin.createUser' | translate }}
            }
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  }

</div>
