<div class="countries-container">
  <div class="header">
    <div class="header__title">
      <h1>
        <i class="fa-solid fa-globe" aria-hidden="true"></i>
        {{ 'admin.countries.title' | translate }}
      </h1>
      <p class="subtitle">{{ 'admin.countries.subtitle' | translate }}</p>
    </div>
    <button mat-flat-button color="primary" (click)="openAddDialog()">
      <i class="fa-solid fa-plus" aria-hidden="true"></i>
      {{ 'admin.countries.add' | translate }}
    </button>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <div class="filters">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'common.search' | translate }}</mat-label>
        <input matInput [(ngModel)]="searchText" (ngModelChange)="applyFilters()"
               [placeholder]="'admin.countries.searchPlaceholder' | translate">
        <i matPrefix class="fa-solid fa-search filter-icon" aria-hidden="true"></i>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>{{ 'admin.countries.region' | translate }}</mat-label>
        <mat-select [(ngModel)]="selectedRegion" (selectionChange)="applyFilters()">
          <mat-option value="">{{ 'common.all' | translate }}</mat-option>
          @for (region of regions(); track region) {
            <mat-option [value]="region">{{ region }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-checkbox [(ngModel)]="showActiveOnly" (change)="applyFilters()">
        {{ 'admin.countries.activeOnly' | translate }}
      </mat-checkbox>

      <span class="filter-count">
        {{ filteredCountries().length }} {{ 'admin.countries.countriesFound' | translate }}
      </span>
    </div>
  </mat-card>

  <!-- Table -->
  <mat-card class="table-card">
    @if (loading()) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    } @else {
      <div class="table-container">
        <table mat-table [dataSource]="filteredCountries()" class="countries-table">

          <!-- Flag -->
          <ng-container matColumnDef="flag">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let country" class="flag-cell">
              {{ getFlag(country.code) }}
            </td>
          </ng-container>

          <!-- Code -->
          <ng-container matColumnDef="code">
            <th mat-header-cell *matHeaderCellDef>{{ 'admin.countries.code' | translate }}</th>
            <td mat-cell *matCellDef="let country">
              <strong>{{ country.code }}</strong>
            </td>
          </ng-container>

          <!-- Name English -->
          <ng-container matColumnDef="nameEn">
            <th mat-header-cell *matHeaderCellDef>{{ 'admin.countries.nameEn' | translate }}</th>
            <td mat-cell *matCellDef="let country">{{ country.nameEn }}</td>
          </ng-container>

          <!-- Name Arabic -->
          <ng-container matColumnDef="nameAr">
            <th mat-header-cell *matHeaderCellDef>{{ 'admin.countries.nameAr' | translate }}</th>
            <td mat-cell *matCellDef="let country" class="rtl-cell">{{ country.nameAr || '—' }}</td>
          </ng-container>

          <!-- Region -->
          <ng-container matColumnDef="region">
            <th mat-header-cell *matHeaderCellDef>{{ 'admin.countries.region' | translate }}</th>
            <td mat-cell *matCellDef="let country">
              @if (country.region) {
                <mat-chip class="region-chip">{{ country.region }}</mat-chip>
              } @else {
                <span class="no-data">—</span>
              }
            </td>
          </ng-container>

          <!-- Is Active -->
          <ng-container matColumnDef="isActive">
            <th mat-header-cell *matHeaderCellDef>{{ 'common.status' | translate }}</th>
            <td mat-cell *matCellDef="let country">
              <mat-chip [class]="country.isActive ? 'status-active' : 'status-inactive'">
                {{ country.isActive ? ('common.active' | translate) : ('common.inactive' | translate) }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Display Order -->
          <ng-container matColumnDef="displayOrder">
            <th mat-header-cell *matHeaderCellDef>{{ 'admin.countries.order' | translate }}</th>
            <td mat-cell *matCellDef="let country">{{ country.displayOrder }}</td>
          </ng-container>

          <!-- Actions -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>{{ 'common.actions' | translate }}</th>
            <td mat-cell *matCellDef="let country" class="actions-cell">
              <button mat-icon-button (click)="openEditDialog(country)"
                      [matTooltip]="'common.edit' | translate">
                <i class="fa-solid fa-pen" aria-hidden="true"></i>
              </button>
              <button mat-icon-button (click)="toggleActive(country)"
                      [matTooltip]="country.isActive ? ('admin.countries.deactivate' | translate) : ('admin.countries.activate' | translate)">
                <i class="fa-solid" [class.fa-eye-slash]="country.isActive" [class.fa-eye]="!country.isActive" aria-hidden="true"></i>
              </button>
              <button mat-icon-button color="warn" (click)="confirmDelete(country)"
                      [matTooltip]="'common.delete' | translate">
                <i class="fa-solid fa-trash" aria-hidden="true"></i>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      @if (filteredCountries().length === 0) {
        <div class="no-data-container">
          <i class="fa-solid fa-globe" aria-hidden="true"></i>
          <p>{{ 'common.noData' | translate }}</p>
        </div>
      }
    }
  </mat-card>
</div>
