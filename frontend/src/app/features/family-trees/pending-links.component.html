<div class="pending-links">
  <!-- Header -->
  <div class="pending-links__header">
    <h1 class="pending-links__title">{{ 'links.pendingRequests' | translate }}</h1>
    <p class="pending-links__subtitle">{{ 'links.reviewDescription' | translate }}</p>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="pending-links__loading">
      <div class="pending-links__spinner"></div>
    </div>
  }

  <!-- Links List -->
  @if (!loading() && links().length > 0) {
    <div class="pending-links__list">
      @for (link of links(); track link.id) {
        <div class="pending-links__card">
          <div class="pending-links__card-inner">
            <div class="pending-links__card-content">
              <!-- Badges -->
              <div class="pending-links__badges">
                <span class="pending-links__type-badge">
                  {{ getLinkTypeLabel(link.linkType) }}
                </span>
                <span class="pending-links__confidence">
                  {{ 'links.confidence' | translate: { value: link.confidence } }}
                </span>
              </div>

              <!-- Persons Grid -->
              <div class="pending-links__persons-grid">
                <div class="pending-links__person-card">
                  <span class="pending-links__person-label">{{ 'links.source' | translate }}</span>
                  <span class="pending-links__person-name">{{ link.sourcePersonName || ('common.unknown' | translate) }}</span>
                  <span class="pending-links__tree-name">{{ link.sourceTreeName }}</span>
                </div>
                <div class="pending-links__person-card">
                  <span class="pending-links__person-label">{{ 'links.target' | translate }}</span>
                  <span class="pending-links__person-name">{{ link.targetPersonName || ('common.unknown' | translate) }}</span>
                  <span class="pending-links__tree-name">{{ link.targetTreeName }}</span>
                </div>
              </div>

              <!-- Notes -->
              @if (link.notes) {
                <div class="pending-links__notes">
                  {{ link.notes }}
                </div>
              }

              <!-- Meta -->
              <div class="pending-links__meta">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                {{ 'links.requestedBy' | translate: { name: link.createdByName || '', date: (link.createdAt | date:'short') || '' } }}
              </div>
            </div>

            <!-- Actions -->
            <div class="pending-links__actions">
              <button
                (click)="approveLink(link)"
                class="pending-links__btn pending-links__btn--approve">
                {{ 'links.approve' | translate }}
              </button>
              <button
                (click)="rejectLink(link)"
                class="pending-links__btn pending-links__btn--reject">
                {{ 'links.reject' | translate }}
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && links().length === 0) {
    <div class="pending-links__empty">
      <div class="pending-links__empty-icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <h3 class="pending-links__empty-title">{{ 'links.noPendingRequests' | translate }}</h3>
      <p class="pending-links__empty-text">{{ 'links.allReviewed' | translate }}</p>
    </div>
  }
</div>

<!-- Review Modal -->
@if (showReviewModal && selectedLink()) {
  <div class="review-modal" (click)="showReviewModal = false">
    <div class="review-modal__content" (click)="$event.stopPropagation()">
      <div class="review-modal__header">
        <h2 class="review-modal__title">
          {{ isApproving ? ('links.approveLinkRequest' | translate) : ('links.rejectLinkRequest' | translate) }}
        </h2>
      </div>

      <div class="review-modal__body">
        <label class="review-modal__label">{{ 'common.notesOptional' | translate }}</label>
        <textarea
          [(ngModel)]="reviewNotes"
          rows="3"
          class="review-modal__textarea"
          [placeholder]="'links.decisionNotesPlaceholder' | translate"></textarea>

        <div class="review-modal__actions">
          <button
            type="button"
            (click)="showReviewModal = false"
            class="review-modal__btn review-modal__btn--cancel">
            {{ 'common.cancel' | translate }}
          </button>
          <button
            (click)="submitReview()"
            [disabled]="submitting()"
            [class]="'review-modal__btn ' + (isApproving ? 'review-modal__btn--approve' : 'review-modal__btn--reject')">
            {{ submitting() ? ('common.submitting' | translate) : (isApproving ? ('links.approve' | translate) : ('links.reject' | translate)) }}
          </button>
        </div>
      </div>
    </div>
  </div>
}
