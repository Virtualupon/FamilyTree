# Technical Debt

## Database Migrations

**Status**: Using `Database.EnsureCreated()` instead of EF Core migrations

**Reason**: 
- EF CLI tools (`dotnet-ef`) not available in Replit environment
- Multiple attempts to create migrations manually failed due to:
  - Complex schema (14 entities, JSONB, tsvector, trigram indexes)
  - ModelSnapshot requirements for proper EF migration tracking
  - Environment limitations preventing programmatic migration generation

**Current Approach**:
- `Database.EnsureCreated()` creates schema directly from ApplicationDbContext
- Manually creates `pg_trgm` extension via raw SQL before schema creation
- Schema matches model configuration exactly (auto-generated by EF Core)

**Impact**:
- ✅ Development: Works perfectly, schema matches model
- ❌ Production: `EnsureCreated()` should not be used in production deployments
- ❌ Schema Evolution: Cannot use incremental migrations for schema changes

**Resolution Plan**:
1. **Short-term (Development)**: Continue using `EnsureCreated()` for rapid iteration
2. **Medium-term**: When dotnet-ef CLI becomes available:
   - Run `dotnet ef migrations add InitialCreate`
   - Replace `EnsureCreatedAsync()` with `MigrateAsync()` in Program.cs
   - Test migration against fresh database
3. **Production**: Must have proper migrations before production deployment

**Files Affected**:
- `backend/FamilyTreeApi/Program.cs` (uses EnsureCreatedAsync instead of MigrateAsync)
- No `Migrations/` directory exists

**Created**: 2024-11-14
**Priority**: Medium (blocks production deployment, OK for development)
