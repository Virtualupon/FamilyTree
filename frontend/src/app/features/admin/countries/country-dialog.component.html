<h2 mat-dialog-title>
  <span class="flag-preview">{{ getFlag() }}</span>
  {{ isEdit ? ('admin.countries.edit' | translate) : ('admin.countries.add' | translate) }}
</h2>

<mat-dialog-content>
  <form [formGroup]="form" class="country-form">

    <!-- Code (2 letters) -->
    <mat-form-field appearance="outline" class="code-field">
      <mat-label>{{ 'admin.countries.code' | translate }} *</mat-label>
      <input matInput formControlName="code" maxlength="2"
             [readonly]="isEdit" style="text-transform: uppercase;">
      <mat-hint>ISO 3166-1 alpha-2 (e.g., EG, US, SA)</mat-hint>
      @if (form.get('code')?.hasError('required')) {
        <mat-error>{{ 'common.required' | translate }}</mat-error>
      }
      @if (form.get('code')?.hasError('pattern')) {
        <mat-error>{{ 'admin.countries.lettersOnly' | translate }}</mat-error>
      }
      @if (form.get('code')?.hasError('minlength') || form.get('code')?.hasError('maxlength')) {
        <mat-error>{{ 'admin.countries.exactTwoChars' | translate }}</mat-error>
      }
    </mat-form-field>

    <!-- Name English -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{ 'admin.countries.nameEn' | translate }} *</mat-label>
      <input matInput formControlName="nameEn" placeholder="Egypt">
      @if (form.get('nameEn')?.hasError('required')) {
        <mat-error>{{ 'common.required' | translate }}</mat-error>
      }
    </mat-form-field>

    <!-- Name Arabic -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{ 'admin.countries.nameAr' | translate }}</mat-label>
      <input matInput formControlName="nameAr" placeholder="مصر" dir="rtl">
    </mat-form-field>

    <!-- Name Local (Nobiin) -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{ 'admin.countries.nameLocal' | translate }}</mat-label>
      <input matInput formControlName="nameLocal" [placeholder]="'admin.countries.localNamePlaceholder' | translate">
    </mat-form-field>

    <!-- Region -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{ 'admin.countries.region' | translate }}</mat-label>
      <mat-select formControlName="region">
        <mat-option value="">{{ 'common.none' | translate }}</mat-option>
        @for (region of regions; track region) {
          <mat-option [value]="region">{{ region }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <div class="row">
      <!-- Display Order -->
      <mat-form-field appearance="outline" class="order-field">
        <mat-label>{{ 'admin.countries.order' | translate }}</mat-label>
        <input matInput type="number" formControlName="displayOrder" min="0">
        <mat-hint>{{ 'admin.countries.orderHint' | translate }}</mat-hint>
      </mat-form-field>

      <!-- Is Active -->
      <mat-checkbox formControlName="isActive" class="active-checkbox">
        {{ 'admin.countries.isActive' | translate }}
      </mat-checkbox>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button mat-dialog-close [disabled]="saving()">
    {{ 'common.cancel' | translate }}
  </button>
  <button mat-flat-button color="primary" (click)="save()" [disabled]="form.invalid || saving()">
    @if (saving()) {
      <mat-spinner diameter="20"></mat-spinner>
    }
    {{ isEdit ? ('common.save' | translate) : ('common.create' | translate) }}
  </button>
</mat-dialog-actions>
